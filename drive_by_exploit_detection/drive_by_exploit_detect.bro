
global mime_to_ext: table[string] of string = {
	["text/html"] = "html",
	["text/x-php"] = "php",
	["text/javascript"] = "js",
	["application/javascript"] = "js",
};


event bro_init()
	{
	print "Script loaded";
	}

event http_request(c: connection, method: string, original_URI: string, unescaped_URI: string, version: string)
	{
	#print fmt("%s -> %s", c$id$resp_h, original_URI);  
	}	

event file_new(f: fa_file)
	{
	
	if(!f?$mime_type)
		{
			return;
		}

	if ( f$mime_type !in mime_to_ext )
		{
		print f$mime_type;
		Files::add_analyzer(f, Files::ANALYZER_EXTRACT);
		return;
		}

	local fname = fmt("%s-%s.%s", f$source, f$id, mime_to_ext[f$mime_type]);
	print fmt("Extracting file %s", fname);
	Files::add_analyzer(f, Files::ANALYZER_EXTRACT, [$extract_filename=fname]);
	}